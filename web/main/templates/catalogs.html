{% extends "base_table.html" %}
{% block more_head %}
{{ super () }}
<title> {{events | length}} Events to display - {{base_title}}</title>
{% endblock %}
{% block content %}
{% if db_stats.num_events > 0 %}
<blockquote class="text-center">
    <p class="lead fs-4 mb-0">
        {{db_stats.num_papers}} Papers processed to find
    </p>
    <p class="lead fs-4 mb-0">
        {{db_stats.num_events}} Events across {{db_stats.num_missions}} Missions
    </p>
    <p class="lead fs-4 mb-0">
        from {{db_stats.global_start}} to {{db_stats.global_stop}}
    </p>
</blockquote>
<hr class="mt-2 mb-3">
{% endif %}
{#
Show missions found in db as clickable buttons, triggering mission's events display
-----------------------------------------------------------------------------------
#}
<form id="catalog-filter" action="{{url_for('main.catalogs')}}" method="post">
    <h4 class="mb-3">Filters:</h4>
    <div class="form-group">
        <label for="duration-min">Min duration (minutes)</label>
        <input class="form-control filter-input" id="duration-min" name="duration-min" type="number" value="{{params.duration_min}}"/>
    </div>
    <div class="form-group">
        <label for="duration-max">Max duration (minutes)</label>
        <input class="form-control filter-input" id="duration-max" name="duration-max" type="number" value="{{params.duration_max}}"/>
    </div>
    <div class="form-group">
        <label for="nconf-min">Min NConf (0.0 - 1.0)</label>
        <input class="form-control filter-input" id="nconf-min" name="nconf-min" type="number" value="{{params.nconf_min}}"
        placeholder="1.0" step="0.01" min="0.0" max="1.0" />
    </div>
    <hr class="mt-2 mb-3">
    <h4 class="mb-3">Available Missions:</h4>
    {% for mission in missions %}
    {% if mission.id in params.selected_missions %}
    {%set checked = "checked"%}
    {% else %}
    {%set checked = ""%}
    {% endif %}
    <label class="btn mission-catalog" title="Show {{mission.num_events}} events for mission {{mission.name}}">
        <input name="missions" type="checkbox" {{ checked }} class="filter-input form-check-input"
               value="{{mission.id}}">
        {{mission.name}}
        <span class="badge bg-light border text-dark">{{mission.num_events}}</span>
    </label>
    {% endfor %}

    <hr class="mt-2 mb-3">
    <input id="show-events-btn" type="submit" value="Show Events" disabled/>

</form>
<hr class="mt-2 mb-3">
{#
Show found events when mission button was clicked
-------------------------------------------------
#}
<div class="mb-3">
    {# Display Selected mission and Button for downloading at text catalog #}
    <span id="get-catalog-title" class="h5"></span>
    <a class="btn btn-warning invisible ms-3" id="get-catalog-txt"
       href="#"
       title="Get catalog as txt">
        Download
    </a>
</div>
<table id="events-table" class="table-hover table">
    <thead>
    <tr>
        <th scope="col" class="col-2">start</th>
        <th scope="col" class="col-2">stop</th>
        <th scope="col" class="col-1">duration</th>
        <th scope="col" class="col-4">doi</th>
        <th scope="col" class="col-1">mission</th>
        <th scope="col" class="col-1">instrument(s)</th>
        <th scope="col" class="col-1">region</th>
        <th scope="col" class="col-1">conf</th>
        <th scope="col" class="col-1">nconf</th>
    </tr>
    </thead>
    <tbody id="events-body">
    {% for _e in events %}
    <tr>
        <td>{{_e.start_date}}</td>
        <td>{{_e.stop_date}}</td>
        <td>{{_e.duration}}</td>
        <td>{{_e.doi}}</td>
        <td>{{_e.mission}}</td>
        <td>{{_e.instrument}}</td>
        <td>{{_e.region}}</td>
        <td>{{_e.conf}}</td>
        <td>{{_e.nconf}}</td>
    </tr>
    {% endfor %}

    </tbody>
</table>

{%  endblock %}

{% block scripts %}
{{ super() }}
<script>

    function enable_submit() {

           if( $('#show-events-btn').hasClass( "to-submit")){
               return;
           }
           $('#show-events-btn').prop('disabled', false);
           $('#show-events-btn').addClass('to-submit', 500);
           $('#show-events-btn').toggle( "pulsate");
           $('#show-events-btn').toggle( "fade");
        }

    $(document).ready(function() {

        // Any check event should turn show 'events button' to color
        $('.filter-input').change( enable_submit);

        // Add datatable stuff
        $('#events-table').DataTable(
            {
            ordering: true,
            search: false,
            paging: false
        });

    });

</script>
{%  endblock %}
